{% extends "base_main.html" %}
{% import "bootstrap/wtf.html" as wtf %}

{% block title %}{{ super() }} - 团队管理{% endblock %}

{% block content_header %}
    <h1>{{ course.name }}：团队管理</h1>
{% endblock %}

{% block breadcrumb %}
    <li><a href="/"><i class="fa fa-dashboard"></i> 主页</a></li>
    <li class="active">团队管理</li>
{% endblock %}

{% block content_main %}
    <article>
        {% for team in teams %}
        <div class="box box-primary">
            <div class="box-header with-border">
                <h3 class="box-title">
                    {{ team.team_name }}
                    {% if team.status == 1 %}
                        <span class="label label-warning">待审批</span>
                    {% elif team.status == 3 %}
                        <span class="label label-danger">已拒绝</span>
                    {% endif %}
                </h3>
            </div>
            <div class="box-body no-padding">
                <table class="table table-hover table-striped">
                    <thead>
                        <tr>
                            <th width="20"></th>
                            <th width="100">id</th>
                            <th>姓名</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><i class="fa fa-user"></i></td>
                            <td>{{ team.owner_id }}</td>
                            <td>{{ team.owner.name }}</td>
                        </tr>
                        {% for member in team.members if member.status==1 %}
                            <tr>
                                <td></td>
                                <td>{{ member.student_id }}</td>
                                <td>{{ member.student.name }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <div class="box-footer">
            {% if team.status == 1 %}
                <div class="btn-group">
                    <div class="input-group">
                        <span class="input-group-btn">
                            <button class="btn btn-primary" type="button" onclick="acceptTeam({{ team.id }})">
                                通过
                            </button>
                        </span>
                        <input id="reason" type="text" class="form-control" placeholder="拒绝理由">
                        <span class="input-group-btn">
                            <button class="btn btn-danger" type="button" onclick="rejectTeam({{ team.id }})">
                                拒绝
                            </button>
                        </span>
                    </div><!-- /input-group -->
                </div>
                {% elif team.status == 3 %}
                    <p class="text-danger">{{ team.reject_reason }}</p>
                {% endif %}
            </div>
        </div>
        <!-- /.box-primary -->
        {% endfor %}
    </article>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
    function acceptTeam(team_id) {
        if(confirm('是否确定要通过？')){
            $.form('', {action: 'accept', team_id: team_id}, 'POST').submit()
        }
    }
    function rejectTeam(team_id) {
        if(confirm('是否确定要拒绝？')){
            $.form('', {action: 'reject', team_id: team_id, reason: $('#reason').val()}, 'POST').submit()
        }
    }
</script>
{% endblock %}